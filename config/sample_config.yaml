# =============================================================================
# AI Radio - Sample Configuration
# =============================================================================
# Purpose:
# - This file is a complete, public reference config.
# - Copy it to `config/local_config.yaml` and adjust values for your setup.
#
# Runtime behavior:
# - `${ENV_VAR}` placeholders are resolved from `.env` in repository root.
# - Pipeline artifacts are written to `.tmp/`.
# - Generated section files are written to `general.section_store_path`.
# =============================================================================

# Global replacement map for custom placeholders.
# Example:
# placeholder_values:
#   "<station_claim>": "Music first. Chaos second."
placeholder_values: {}

general:
  # Public show/format name.
  # Used in target playlist naming.
  name: Example Radio Mix

  # IANA timezone for timestamp placeholders and local date suffix.
  timezone: Europe/Berlin

  # Location used by WEATHER and NEWS context providers.
  location:
    city: Berlin
    country: Germany

  # System instruction baseline for all AI text generations.
  # Keep it stable and broad. Per-section behavior belongs in section prompts.
  instructions: >
    On-air radio host style with energetic, concise, spoken-word phrasing.
    Tone stays playful, clear, and listener-friendly.
    Metadata cleanup rule: ignore placeholder values like unknown or n/a.
    Ignore track numbers at title start (01, 02, 1., 07 -), keep only real title text.

  # LLM model used in step 3 for section text generation.
  model: gpt-4o-mini

  # Optional temperature for text generation style variance.
  # Lower = more stable, higher = more creative.
  temperature: 0.7

  # Max output tokens per LLM generation call.
  max_tokens: 900

  # Local folder where step 4 writes generated TXT + MP3 section files.
  # Absolute or relative path.
  section_store_path: "./output/sections/"

  # Local folder where section cover image files are read from/written to.
  # Used by step_generate_covers.py and step4_tts_sections.py.
  covers_path: "./covers/"

  # Optional cover image for the generated target playlist in Music Assistant.
  # Can be a filename under covers_path, absolute file path, or http(s) URL.
  playlist_cover_image: air.png

providers:
  # ---------------------------------------------------------------------------
  # LLM provider (required)
  # ---------------------------------------------------------------------------
  - type: LLM
    config:
      provider_name: OpenAI
      api_key: ${OPENAI_API_KEY}

      # Optional billing-capable key for step 5 cost query (/organization/costs).
      admin_api_key: ${OPENAI_ADMIN_KEY}

      # Optional image generation settings used by step_generate_covers.py.
      image_model: gpt-image-1
      image_size: "1024x1024"

  # ---------------------------------------------------------------------------
  # TTS provider (required)
  # Supported provider_name values: OpenAI, ElevenLabs
  # OpenAI TTS is fully supported and remains a valid choice.
  # ---------------------------------------------------------------------------
  - type: TTS
    config:
      # OpenAI example:
      provider_name: OpenAI
      api_key: ${OPENAI_API_KEY}
      model: gpt-4o-mini-tts

      # Explicit voice for OpenAI TTS.
      # Examples (model-dependent): alloy, ash, ballad, coral, echo,
      # fable, nova, onyx, sage, shimmer, verse, marin, cedar.
      voice: ballad

      # Optional prosody/style instruction string for speech synthesis.
      instructions: >
        Radio-host delivery, warm tone, clean articulation, short natural pauses.

      # ElevenLabs alternative:
      # provider_name: ElevenLabs
      # api_key: ${ELEVENLABS_API_KEY}
      # model: eleven_multilingual_v2
      # voice_id: xj61lbryotizgwAuHImw
      # output_format: mp3_44100_128

  # ---------------------------------------------------------------------------
  # NEWS provider (optional)
  # Required only if section prompts use news placeholders:
  # - <news_headlines_local>
  # - <news_headlines_national>
  # - <news_headlines_international>
  # ---------------------------------------------------------------------------
  - type: NEWS
    config:
      provider_name: OpenAI
      api_key: ${OPENAI_API_KEY}

      # Fallback model list used for web-search-based responses.
      model:
        - gpt-4o-mini
        - gpt-4.1-mini

      # Strict freshness window for accepted headlines (days, inclusive).
      # Example: 3 means "today and previous 3 days".
      max_age_days: 3

      # Prompt templates are required in config (no hardcoded defaults).
      # Supported variables: {city}, {country}
      local_prompt: >
        Give exactly 5 short current local news headlines for {city}, {country}.
        No intro, no numbering, one headline per line.
        Include at least one positive news item if available.
      national_prompt: >
        Give exactly 5 short current national news headlines for {country}.
        No intro, no numbering, one headline per line.
        Include at least one positive news item if available.
      international_prompt: >
        Give exactly 5 short current international world news headlines.
        No intro, no numbering, one headline per line.
        Include at least one positive news item if available.

  # ---------------------------------------------------------------------------
  # WEATHER provider (optional)
  # Required only if section prompts use weather placeholders:
  # - <weather_hourly>
  # - <weather_daily>
  # ---------------------------------------------------------------------------
  - type: WEATHER
    config:
      provider_name: open-meteo
      timeout_seconds: 20

  # ---------------------------------------------------------------------------
  # MUSIC provider (required)
  # ---------------------------------------------------------------------------
  - type: MUSIC
    config:
      provider_name: MusicAssistant
      base_url: https://music-assistant.local/
      verify_ssl: true
      api_key: ${MUSIC_ASSISTANT_API_KEY}

      # Source playlist in Music Assistant (input playlist).
      playlist_id: 1

      # Optional source limiter in step 2:
      # randomly select tracks until accumulated duration exceeds this value (minutes).
      # Set to 0 to disable and use all source tracks.
      max_duration: 60

      # Provider where source playlist is stored.
      provider_instance_id_or_domain: library

      # Provider where generated section MP3s are indexed.
      # `sections_provider_instance` is preferred if both are set.
      sections_provider_instance: filesystem_local--instance-id
      sections_provider_domain: filesystem_local

      # Wait after pre-TTS sync trigger (step 4).
      pre_tts_sync_wait_seconds: 5

      # Wait after post-TTS sync trigger (step 5).
      post_tts_sync_wait_seconds: 5

      # Polling window while waiting for generated section files
      # to appear as indexed MA tracks.
      sections_rescan_timeout_seconds: 180
      sections_rescan_poll_seconds: 5

sections:
  # ---------------------------------------------------------------------------
  # Section definition rules
  # ---------------------------------------------------------------------------
  # id:
  #   Internal identifier used in section_order.
  # name:
  #   Human-readable name used for MP3 title metadata.
  # type:
  #   - ai_text: normal generated section
  #   - ai_meta: used to merge multiple sections in same between-song slot
  #     (its output name is derived from merged ai_text section names)
  # cover_image:
  #   Filename under general.covers_path. Optional.
  # prompt:
  #   Text prompt with placeholders.
  # web_search:
  #   Optional per ai_text section web search mode:
  #   - disabled (default): no web tool
  #   - allow: web tool available, model may decide to use it
  #   - force: web tool is required
  #   Note: ai_meta sections do not support this field; their mode is derived
  #   from merged ai_text sections with priority: force > allow > disabled.
  # constraints.max_chars:
  #   Soft target length; small overflow is allowed to avoid hard cut-offs.

  - id: Song_Introduction_Start
    name: Song Introduction Start
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      First track: <next_songinfo>.
      Open the show, set station vibe, and introduce the segment.
      Use local time <timestamp> and weather mood from <weather_hourly> if available.
    constraints:
      max_chars: 650

  - id: Song_Introduction_Middle
    name: Song Introduction Middle
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      Brief, engaging intro for <next_songinfo>.
      Keep it conversational and compact.
    constraints:
      max_chars: 650

  - id: Song_Introduction_End
    name: Song Introduction End
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      Last track: <next_songinfo>.
      Leave a memorable close.
    constraints:
      max_chars: 650

  - id: Song_Transition
    name: Song Transition
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      Transition from <prev_songinfo> to <next_songinfo>.
      Keep flow natural and connected.
    constraints:
      max_chars: 600

  - id: Song_FunFacts_Context
    name: Song Fun Facts
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      Add a short context or fun fact around <prev_songinfo> or <next_songinfo>.
      Keep it smart and listener-friendly.
    constraints:
      max_chars: 650

  - id: Song_Random_Funny_Life_Bit
    name: Random Funny Life Bit
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      Mention <prev_songinfo> and <next_songinfo> once each, then switch into a short
      humorous personal-style monologue. No hate speech. No explicit violence.
    constraints:
      max_chars: 650

  - id: Weather_Short
    name: Weather Short
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      Short weather update from <weather_hourly> with time <timestamp>.
      Spoken style, natural wording.
    constraints:
      max_chars: 500

  - id: News_Headlines_Local
    name: Local News
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      Local headlines from <news_headlines_local>.
    constraints:
      max_chars: 1000

  - id: News_Headlines_National
    name: National News
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      National headlines from <news_headlines_national>.
    constraints:
      max_chars: 1500

  - id: News_Headlines_International
    name: International News
    type: ai_text
    web_search: disabled
    cover_image: air.png
    prompt: >
      International headlines from <news_headlines_international>.
    constraints:
      max_chars: 1500

  - id: Between_Songs_Smoother
    name: Between Songs Mix
    type: ai_meta
    cover_image: air.png
    prompt: >
      Merge multiple snippets between <prev_songinfo> and <next_songinfo> into one coherent
      spoken segment. Keep transitions smooth and avoid repetition.
      Input:
      <section_drafts>

section_order:
  # start_of_playlist: before first track
  - when: start_of_playlist
    flow:
      - MUST: Song_Introduction_Start

  # between_songs: between each adjacent source track pair
  - when: between_songs
    flow:
      # Exactly one alternative is selected.
      - ALTERNATIVE:
          choices:
            - section: Song_Transition
              weight: 30
            - section: Song_Introduction_Middle
              weight: 25
            - section: Song_FunFacts_Context
              weight: 30
            - section: Song_Random_Funny_Life_Bit
              weight: 15

      # OPTIONAL blocks are evaluated independently.
      # They can stack and may trigger ai_meta merging for same slot.
      - OPTIONAL:
          section: Weather_Short
          chance: 0.2
          guards:
            min_gap_songs: 3
            max_per_60min: 1
            require_placeholders_present:
              - "<weather_hourly>"
              - "<timestamp>"

      - OPTIONAL:
          section: News_Headlines_Local
          chance: 0.1
          guards:
            min_gap_songs: 4
            max_per_60min: 1
            require_placeholders_present:
              - "<news_headlines_local>"

      - OPTIONAL:
          section: News_Headlines_National
          chance: 0.1
          guards:
            min_gap_songs: 5
            max_per_60min: 1
            require_placeholders_present:
              - "<news_headlines_national>"

      - OPTIONAL:
          section: News_Headlines_International
          chance: 0.1
          guards:
            min_gap_songs: 6
            max_per_60min: 1
            require_placeholders_present:
              - "<news_headlines_international>"

  # end_of_playlist: after last track
  - when: end_of_playlist
    flow:
      - MUST: Song_Introduction_End

validation:
  # true: fail early on invalid/unknown section references
  strict: true
