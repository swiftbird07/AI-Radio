version: 1

placeholder_values: {}

general:
  name: Example Radio Mix
  timezone: Europe/Berlin
  location:
    city: Berlin
    country: Germany
  instructions: >
    On-air radio host style with energetic, concise, spoken-word phrasing.
    Tone stays playful, clear, and listener-friendly.
    Metadata cleanup rule: ignore placeholder values like unknown or n/a.
    Ignore track numbers at title start (01, 02, 1., 07 -), keep only real title text.
  model: gpt-4o-mini
  max_tokens: 900
  voice_style: ballad
  sections_path_local: "./output/sections/"

providers:
  - type: LLM
    config:
      provider_name: OpenAI
      api_key: ${OPENAI_API_KEY}
      admin_api_key: ${OPENAI_ADMIN_KEY}

  - type: TTS
    config:
      provider_name: OpenAI
      api_key: ${OPENAI_API_KEY}
      model: gpt-4o-mini-tts
      voice: ballad
      instructions: >
        Radio-host delivery, warm tone, clean articulation, short natural pauses.

  - type: NEWS
    config:
      provider_name: OpenAI
      api_key: ${OPENAI_API_KEY}
      model:
        - gpt-4o-mini
        - gpt-4.1-mini
      local_prompt: >
        Give exactly 5 short current local news headlines for {city}, {country}.
        No intro, no numbering, one headline per line. NO SPORT NEWS.
        Include at least one positive news item if available.
      national_prompt: >
        Give exactly 5 short current national news headlines for {country}.
        No intro, no numbering, one headline per line. NO SPORT NEWS.
        Include at least one positive news item if available.
      international_prompt: >
        Give exactly 5 short current international world news headlines.
        No intro, no numbering, one headline per line. NO SPORT NEWS.
        Include at least one positive news item if available.

  - type: WEATHER
    config:
      provider_name: open-meteo
      timeout_seconds: 20

  - type: MUSIC
    config:
      provider_name: MusicAssistant
      base_url: https://music-assistant.local/
      verify_ssl: true
      api_key: ${MUSIC_ASSISTANT_API_KEY}
      playlist_id: 1
      max_duration: 60
      provider_instance_id_or_domain: library
      sections_provider_instance: filesystem_local--instance-id
      sections_provider_domain: filesystem_local
      pre_tts_sync_wait_seconds: 5
      post_tts_sync_wait_seconds: 5
      sections_rescan_timeout_seconds: 180
      sections_rescan_poll_seconds: 5

sections:
  - id: Song_Introduction_Start
    type: ai_text
    prompt: >
      First track: <next_songinfo>.
      Open the show, set station vibe, and introduce the segment.
      Use local time <timestamp> and weather mood from <weather_hourly> if available.
    constraints:
      max_chars: 650

  - id: Song_Introduction_Middle
    type: ai_text
    prompt: >
      Brief, engaging intro for <next_songinfo>.
      Keep it conversational and compact.
    constraints:
      max_chars: 650

  - id: Song_Introduction_End
    type: ai_text
    prompt: >
      Last track: <next_songinfo>.
      Leave a memorable close.
    constraints:
      max_chars: 650

  - id: Song_Transition
    type: ai_text
    prompt: >
      Transition from <prev_songinfo> to <next_songinfo>.
      Keep flow natural and connected.
    constraints:
      max_chars: 600

  - id: Song_FunFacts_Context
    type: ai_text
    prompt: >
      Add a short context or fun fact around <prev_songinfo> or <next_songinfo>.
      Keep it smart and listener-friendly.
    constraints:
      max_chars: 650

  - id: Song_Random_Funny_Life_Bit
    type: ai_text
    prompt: >
      Mention <prev_songinfo> and <next_songinfo> once each, then switch into a short
      humorous personal-style monologue. No hate speech. No explicit violence.
    constraints:
      max_chars: 650

  - id: Weather_Short
    type: ai_text
    prompt: >
      Short weather update from <weather_hourly> with time <timestamp>.
      Spoken style, natural wording.
    constraints:
      max_chars: 500

  - id: News_Headlines_Local
    type: ai_text
    prompt: >
      Local headlines from <news_headlines_local>.
    constraints:
      max_chars: 1000

  - id: News_Headlines_National
    type: ai_text
    prompt: >
      National headlines from <news_headlines_national>.
    constraints:
      max_chars: 1500

  - id: News_Headlines_International
    type: ai_text
    prompt: >
      International headlines from <news_headlines_international>.
    constraints:
      max_chars: 1500

  - id: Between_Songs_Smoother
    type: ai_meta
    prompt: >
      Merge multiple snippets between <prev_songinfo> and <next_songinfo> into one coherent
      spoken segment. Keep transitions smooth and avoid repetition.
      Input:
      <section_drafts>

section_order:
  - when: start_of_playlist
    flow:
      - MUST: Song_Introduction_Start

  - when: between_songs
    flow:
      - ALTERNATIVE:
          pick: one
          choices:
            - section: Song_Transition
              weight: 30
            - section: Song_Introduction_Middle
              weight: 25
            - section: Song_FunFacts_Context
              weight: 30
            - section: Song_Random_Funny_Life_Bit
              weight: 15
      - OPTIONAL:
          section: Weather_Short
          chance: 0.2
          guards:
            min_gap_songs: 3
            max_per_60min: 1
            require_placeholders_present:
              - "<weather_hourly>"
              - "<timestamp>"
      - OPTIONAL:
          section: News_Headlines_Local
          chance: 0.1
          guards:
            min_gap_songs: 4
            max_per_60min: 1
            require_placeholders_present:
              - "<news_headlines_local>"
      - OPTIONAL:
          section: News_Headlines_National
          chance: 0.1
          guards:
            min_gap_songs: 5
            max_per_60min: 1
            require_placeholders_present:
              - "<news_headlines_national>"
      - OPTIONAL:
          section: News_Headlines_International
          chance: 0.1
          guards:
            min_gap_songs: 6
            max_per_60min: 1
            require_placeholders_present:
              - "<news_headlines_international>"

  - when: end_of_playlist
    flow:
      - MUST: Song_Introduction_End

validation:
  strict: true
